## 部署开源大语言模型ChatGLM

从《简单》学点大模型开始，我学习到了这种大语言模型的基本原理以及它是如何训练出来的，训练成本有多少。

不过底层的原理要理解仍然需要不少的AI基础学习（我目前做的还不够），但部署已开源的大模型很显然会更加简单一些（能部署就是成功）。

上次的练习已经让我熟悉了基本的新建项目的工作，然后是时候开始建立另一个项目了。

![工作面板](/img/virtaicloud09.png)

**按照教程来弄，别选错模型了。**

GLM的代码量不是很大，不过现在暂时不是看代码的时候，而是开始训练的时候。

配置好镜像之后进入到云环境，一切正常。

需要在requirements.txt里添加以下内容

```
rouge_chinese
nltk
jieba
datasets
```

![工作面板](/img/virtaicloud10.png)

然后网页终端执行命令

```bash
pip install -r ChatGLM2-6B/requirements.txt -i https://pypi.virtaicloud.com/repository/pypi/simple
```
一切顺利……

修改实际挂载地址……
![工作面板](/img/virtaicloud11.png)


接下来，开始部署CHATGLM

```
python ChatGLM2-6B/cli_demo.py
```

在这里，我们似乎没有在直接训练ChatGLM，而是直接拿出已经训练好的模型，然后即开即用。

但是有了这样的一个大模型就是一个好的开始，不过我在想我还能做些什么，比如尝试理解代码，修改参数等等？

好，我开始使用GLM了，但是好像出了点意外……
另外生成速度大概在半分钟的时间。


![工作面板](/img/virtaicloud12.png)

```
**朵朵**：我叫朵朵，请教一下什么是LLM的注意力机制？

**ChatGLM**： LLM的注意力机制是一种在自然语言处理中广泛使用的技术,可以帮助模型更好地理解和处理自然语言文本。

注意力机制可以理解为一种加权分配机制,会根据当前任务或上下文,动态地选择性地聚焦于输入序列中的不同部分,从而提高模型的表示能力和处理能力。

在LLM中,注意力机制通常用于文本分类、机器翻译、问答系统等任务中。它可以帮助模型抓住输入文本中的重要信息,减少信息丢失,提高模型的准确性和效率。

简单来说,LLM的注意力机制就是一个智能化的筛选器,会根据任务和上下文,自动地聚焦于输入文本中的关键部分,从而提高模型的表现。

**朵朵**：非常好，那么我想让你编写一个新的故事，关于朵朵训练一个新的ChatGLM3.0的故事，他是一个新手AI工程师，然后通过自己的努力，改进2.0模型最后推动到了3.0模型。

**ChatGLM**：朵朵是一个新手AI工程师,他一直梦想着成为一名优秀的自然语言处理专家。虽然他对自然语言处理领域有着浓厚的兴趣,但是他对于机器学习和深度学习方面的知识还不够扎实。

有一天,他接到了公司的一个任务,需要训练一个新的ChatGLM3.0模型。作为一名新手,他心里有点慌乱,但是他还是决定努力一下,开始了模型的训练工作。

在训练过程中,朵朵遇到了很多问题。他不知道该从哪里开始,也不知道如何提高模型的表现。但是,他并没有放弃,一遍遍地调试和改进,不断地寻找新的方法来解决问题。

经过一段时间的努力,朵朵终于成功地训练出了一个新的ChatGLM3.0模型。这个模型比2.0模型表现更好,准确率更高,朵朵也感到非常自豪和兴奋。

接下来的任务中,朵朵继续不断地努力学习和改进。他不断地探索新的技术和方法,积极地参与公司的技术交流和分享,不断提高自己的技能和能力。

最终,经过一段时间的不断努力,朵朵终于成功地推动了一个2.0模型向3.0模型的升级。他的努力得到了公司领导和同事们的认可和赞赏,也让他更加自信和坚定地继续前行,深入研究和发展自然语言处理技术。
```
至少来说终于可以玩起来了。

部署很顺利，不过我还不想那么快结束我的游戏呢。

## Web Demo探索

之前，我们运行的是cli demo，也就是用命令行和AI对话，现在可以尝试一下另一个demo，看看运行结果是什么样子？



需要修改以下代码

```py
tokenizer = AutoTokenizer.from_pretrained("/gemini/data-2", trust_remote_code=True)
model = AutoModel.from_pretrained("/gemini/data-2", trust_remote_code=True).cuda()
# last row
demo.queue().launch(share=True, inbrowser=True)
```

然后开始运行
```
python ChatGLM2-6B/web_demo.py
```

尽管能够部署，但是依然存在新的坑，仍然需要寻求更多的帮助来解决问题……


![工作面板](/img/virtaicloud13.png)